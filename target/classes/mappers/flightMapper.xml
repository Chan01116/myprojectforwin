<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.chan.aws0822.persistance.FlightMapper">
    <select id="searchFlights" parameterType="HashMap" resultType="fv">
    SELECT f.*, 
           dep.airport_code as departure_code,
           arr.airport_code as arrival_code
    FROM flight f
    JOIN airport dep ON f.departure_airport_id = dep.airport_id
    JOIN airport arr ON f.arrival_airport_id = arr.airport_id
    WHERE dep.airport_code = #{departure}
    AND arr.airport_code = #{arrival}
    AND DATE(f.departure_time) = #{departureDate}
    AND f.available_seats >= #{passengerCount}
    ORDER BY f.departure_time ASC
</select>
</mapper>